<!DOCTYPE html>
<html lang="de">
  


<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Statistiken – FantasyBlitz</title>
  <!-- Favicons -->
  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" type="image/png" href="/favicon-48x48.png" sizes="48x48">
  <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
  <link rel="apple-touch-icon" href="/favicon-apple-touch.png">
  <!-- CSS -->
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="css/site.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>

<script>
  Chart.defaults.datasets.bar.categoryPercentage = 0.5; // Luft zwischen Kategorien
  Chart.defaults.datasets.bar.barPercentage = 0.9;      // Balkenbreite innerhalb der Kategorie
</script>


  <script>
    // Aktive Seite hervorheben
    const currentPage = window.location.pathname.split("/").pop();
    document.addEventListener("DOMContentLoaded", () => {
      document.querySelectorAll("nav a").forEach(link => {
        if (link.getAttribute("href") === currentPage) link.classList.add("active");
      });
    });
  </script>

  <style>
    /* Schlanke Zusatzstyles für die Stats-Karten */
    .stats-card {
      max-width: 1100px;
      margin: 24px auto;
      padding: 20px;
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.07);
    }
    .stats-header { display: flex; align-items: center; justify-content: space-between; gap: 10px; margin-bottom: 10px; }
    .stats-header h2 { margin: 0; font-size: 1.3rem; }
    .controls { display: flex; gap: 6px; flex-wrap: wrap; }
    .btn { border: 1px solid #ddd; padding: 6px 10px; border-radius: 10px; background: #f6f6f6; cursor: pointer; font-size: 0.95rem; }
    .btn.active { border-color: #222; background: #eee; }

    .chart-wrap { width: 100%; height: 720px; }
    @media (max-width: 900px) { .chart-wrap { height: 980px; } }
  </style>
<script>
  (function () {
    // 👉 später echte Live-Domains hier eintragen, z.B.: ['fantasyblitz.ch','www.fantasyblitz.ch']
    var PROD_HOSTS = []; 
    if (!PROD_HOSTS.includes(location.hostname)) return; // lokal/preview -> kein Tracking

    var s = document.createElement('script');
    s.defer = true;
    s.src = 'https://static.cloudflareinsights.com/beacon.min.js';
    s.setAttribute('data-cf-beacon', '{"token":"DEIN_TOKEN"}'); // 👉 später ersetzen
    document.head.appendChild(s);
  })();
</script>
</head>

<body class="site-v2 site-v2">
  <header class="site-header">
  <div class="container header-inner">
    <a class="brand" href="index.html" aria-label="Startseite">
          <picture>
            <img src="img/fantasyblitz-logo.png" alt="FantasyBlitz Logo" />
          </picture>
    </a>
    <nav class="nav-desktop" aria-label="Hauptnavigation">
      <ul class="nav-list">
        <li><a href="index.html">Startseite</a></li>
        <li><a href="rankings.html">Weekly Rankings</a></li>
        <li><a href="waivers.html">Waivers</a></li>
        <li class="dropdown">
          <button class="nav-link nav-caret" aria-expanded="false">Draft</button>
          <div class="submenu" role="menu">
            <a href="draft-2025.html">Draft Cheat Sheet</a>
            <a href="draft-guide.html">Draft Guide</a>
          </div>
        </li>
        <li><a href="stats.html">Stats</a></li>
        <li><a href="info.html">Info</a></li>
      </ul>
    </nav>
    <button class="nav-toggle" aria-label="Menü öffnen" aria-expanded="false">
      <span class="bar"></span><span class="bar"></span><span class="bar"></span>
    </button>
  </div>
</header>

<nav class="nav-panel container" id="navPanel" aria-label="Mobiles Menü">
  <a href="index.html">Startseite</a>
  <a href="rankings.html">Weekly Rankings</a>
  <a href="waivers.html">Waivers</a>
  <div class="dropdown">
    <button class="nav-link nav-caret" id="draftToggle" aria-expanded="false">Draft</button>
    <div class="submenu">
      <a href="draft-2025.html">Draft Cheat Sheet</a>
      <a href="draft-guide.html">Draft Guide</a>
    </div>
  </div>
  <a href="stats.html">Stats</a>
  <a href="info.html">Info</a>
</nav>
<div class="overlay" id="overlay" hidden></div>

  <main class="rankings-page">
<div class="header-row">
  <h2>Statistiken & Charts</h2>
  <div class="header-right">
    <!-- Optional: später Filter/Season-Selector etc. -->
    <!-- <select class="position-button week-select"><option>Season: 2024</option></select> -->
  </div>
</div>

 <p class="intro-text">
  Die wichtigsten Team-Stats auf einen Blick. Die Statistiken werden im Laufe der Saison aktualisiert –
  und es kommen neue, relevante Charts dazu.
</p>
 <p class="intro-text">
  <strong>Hinweis (Offseason):</strong> Zwischen den Saisons verändern sich oft zentrale Rollen –
  insbesondere Quarterback-Wechsel sowie Anpassungen im Coaching oder Play-Calling.
  Dadurch können sich erwartete Team-Punkte und Spieltendenzen zur neuen Saison deutlich verschieben.
</p>

    <!-- CHART 1: OFFENSE PPG -->
    <section class="stats-card" id="offense-ppg">
      <div class="stats-header">
        <h2>Offense: Punkte pro Spiel (2024)</h2>
        <div class="controls">
          <button id="sortPPG" class="btn active" title="Nach Punkten/Spiel sortieren">Sort: PPG</button>
          <button id="sortAlpha" class="btn" title="Alphabetisch sortieren">Sort: A–Z</button>
        </div>
      </div>

      <p style="margin:0 0 8px;color:#444;">
        <strong>Warum relevant?</strong> Teams mit vielen Punkten produzieren häufiger Touchdowns und Red-Zone-Chancen.
        Spieler in High-Scoring-Offenses haben tendenziell mehr Fantasy-Upside – ideal als Draft-Tiebreaker und für Start/Sit.
      </p>

      <div class="chart-wrap">
        <canvas id="offPpgChart"></canvas>
      </div>
      <p style="margin-top:10px;color:#666;font-size:0.95rem">
        Quelle: Daten aus <a href="https://www.pro-football-reference.com/" target="_blank" rel="noopener">pro-football-reference.com</a>.
        Werte als Punkte pro Spiel
      </p>
    </section>

    <!-- CHART 2: DEFENSE PASS/RUSH YDS PER GAME -->
    <section class="stats-card" id="defense-yds">
      <div class="stats-header">
        <h2>Defense: Passing- vs. Rushing-Yards pro Spiel (2024)</h2>
        <div class="controls">
          <button id="sortTotal" class="btn active" title="Nach Gesamt-Yards/Spiel sortieren">Sort: Total</button>
          <button id="sortPass" class="btn" title="Nach Passing-Yards/Spiel sortieren">Sort: Passing</button>
          <button id="sortRush" class="btn" title="Nach Rushing-Yards/Spiel sortieren">Sort: Rushing</button>
        </div>
      </div>

      <p style="margin:0 0 8px;color:#444;">
        <strong>Warum relevant?</strong> Zeigt, welche Defenses eher durch die Luft bzw. am Boden verwundbar sind.
        So kannst du Matchups besser einschätzen und RB/WR/TE gezielter aufstellen.
      </p>

      <div class="chart-wrap">
        <canvas id="defYdsChart"></canvas>
      </div>
      <p style="margin-top:10px;color:#666;font-size:0.95rem">
        Quelle: Daten aus <a href="https://www.pro-football-reference.com/" target="_blank" rel="noopener">pro-football-reference.com</a>.
        Werte als Yards pro Spiel
      </p>
    </section>
  </main>

<footer class="site-footer" role="contentinfo">
  <p>
    © <span id="y">2025</span> FantasyBlitz ·
    <a class="footer-link" href="impressum.html">Impressum</a> ·
    <a class="footer-link" href="datenschutz.html">Datenschutz</a>
  </p>
</footer>

<script>
  // Jahr automatisch: "2025" oder "2025–{aktuelles Jahr}"
  (function(){
    var start=2025, y=new Date().getFullYear();
    var el=document.getElementById('y'); if(el) el.textContent = y>start ? (start + '–' + y) : String(start);
  })();
</script>

<script>
  /* -------------------- Pfade zu CSVs -------------------- */
  const OFF_CSV = 'data/2024/team_stats_off_2024.csv';
  const DEF_CSV = 'data/2024/team_stats_def_2024.csv';

  /* -------------------- Helper: Normalisieren & Dedupe -------------------- */
  function normalizeTeamName(s) {
    // NBSP -> Space, Mehrfach-Spaces zu einem, trim
    let t = String(s || '').replace(/\u00A0/g, ' ').replace(/\s+/g, ' ').trim();

    // bekannte Korrekturen (Liste erweiterbar)
    const fixes = {
      'Atalanta Falcons': 'Atlanta Falcons',
      'New  Orleans Saints': 'New Orleans Saints'
    };
    return fixes[t] || t;
  }

  function dedupeByTeam(rows, picker = (a, b) => a) {
    const map = new Map();
    for (const r of rows) {
      const key = normalizeTeamName(r.team);
      if (!map.has(key)) {
        map.set(key, { ...r, team: key });
      } else {
        const keep = picker(map.get(key), r);
        map.set(key, { ...keep, team: key });
      }
    }
    return Array.from(map.values());
  }

  function logDuplicates(rows) {
    const seen = new Set(), dups = new Set();
    for (const r of rows) {
      const k = normalizeTeamName(r.team);
      if (seen.has(k)) dups.add(k); else seen.add(k);
    }
    if (dups.size) console.warn('⚠️ Duplikate gefunden für Teams:', Array.from(dups));
  }

  // Chart-Optik: keine Bar-Ränder (verhindert "Streifen"-Effekt)
  if (window.Chart) {
    Chart.defaults.elements.bar.borderWidth = 0;
  }

  /* -------------------- OFFENSE (Punkte pro Spiel) -------------------- */
  async function loadOffense() {
    const text = await fetch(OFF_CSV).then(r => r.text());
    const lines = text.split(/\r?\n/).filter(Boolean);

    // Header finden
    const headerIdx = lines.findIndex(l => l.startsWith('Rk,Tm,G,'));
    if (headerIdx === -1) return [];

    // Relevante Datenzeilen (Summary-Zeilen raus)
    const dataLines = lines.slice(headerIdx + 1)
      .filter(l => !l.startsWith(',Avg') && !l.startsWith(',League') && l.trim() !== '');

    const rows = [];
    for (const line of dataLines) {
      const parts = line.split(',');
      if (!/^\d+$/.test(parts[0])) continue; // nur echte Team-Zeilen

      const team = normalizeTeamName(parts[1]);
      const g  = parseInt(parts[2], 10);
      const pf = parseFloat(parts[3]); // Total Points

      if (!team || !Number.isFinite(g) || !Number.isFinite(pf) || g <= 0) continue;

      rows.push({ team, g, ppg: pf / g });
    }

    logDuplicates(rows);
    // Bei Duplikaten: den Datensatz mit mehr Spielen behalten
    const deduped = dedupeByTeam(rows, (a, b) => (b.g > a.g ? b : a));
    return deduped;
  }

  function makeOffChart(ctx, dataset) {
    const labels = dataset.map(d => d.team);
    const ppg = dataset.map(d => +d.ppg.toFixed(1));

    return new Chart(ctx, {
      type: 'bar',
      data: {
        labels,
        datasets: [{
          label: 'Punkte pro Spiel',
          data: ppg,
          barThickness: 12,
          maxBarThickness: 14
        }]
      },
      options: {
        indexAxis: 'y',
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { display: false },
          tooltip: { callbacks: { label: (ctx) => `${ctx.raw} Pkt/Spiel` } }
        },
        scales: {
          x: { title: { display: true, text: 'Punkte pro Spiel' }, grid: { drawBorder: false } },
          y: { grid: { display: false }, offset: true }
        },
        animation: false
      }
    });
  }

  /* -------------------- DEFENSE (Passing/Rushing-Yards pro Spiel) -------------------- */
  async function loadDefense() {
    const text = await fetch(DEF_CSV).then(r => r.text());
    const lines = text.split(/\r?\n/).filter(Boolean);

    const headerIdx = lines.findIndex(l => l.startsWith('Rk,Tm,G,'));
    if (headerIdx === -1) return [];

    const dataLines = lines.slice(headerIdx + 1)
      .filter(l => !l.startsWith(',Avg') && !l.startsWith(',League') && l.trim() !== '');

    const rows = [];
    for (const line of dataLines) {
      const parts = line.split(',');
      if (!/^\d+$/.test(parts[0])) continue;

      const team = normalizeTeamName(parts[1]);
      const g = parseInt(parts[2], 10);

      // PFR Defense CSV: Totals → Passing@12, Rushing@18 (wie bei dir)
      const passYdsTot = parseFloat(parts[12]);
      const rushYdsTot = parseFloat(parts[18]);

      if (!team || !Number.isFinite(g) || g <= 0 ||
          !Number.isFinite(passYdsTot) || !Number.isFinite(rushYdsTot)) continue;

      rows.push({
        team, g,
        passPerG: passYdsTot / g,
        rushPerG: rushYdsTot / g,
        totalPerG: (passYdsTot + rushYdsTot) / g
      });
    }

    logDuplicates(rows);
    const deduped = dedupeByTeam(rows, (a, b) => (b.g > a.g ? b : a));
    return deduped;
  }

  function makeDefChart(ctx, dataset) {
    const labels = dataset.map(d => d.team);
    const pass = dataset.map(d => +d.passPerG.toFixed(1));
    const rush = dataset.map(d => +d.rushPerG.toFixed(1));

    return new Chart(ctx, {
      type: 'bar',
      data: {
        labels,
        datasets: [
          {
            label: 'Passing-Yards/Spiel (Defense)',
            data: pass,
            stack: 'yds',
            backgroundColor: 'rgba(241,196,15,0.85)',
            borderColor: 'rgba(241,196,15,1)',
            borderWidth: 0,
            barThickness: 12,
            maxBarThickness: 14
          },
          {
            label: 'Rushing-Yards/Spiel (Defense)',
            data: rush,
            stack: 'yds',
            backgroundColor: 'rgba(230,126,34,0.85)',
            borderColor: 'rgba(230,126,34,1)',
            borderWidth: 0,
            barThickness: 12,
            maxBarThickness: 14
          }
        ]
      },
      options: {
        indexAxis: 'y',
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { position: 'top' },
          tooltip: {
            callbacks: {
              footer: (items) => {
                const i = items[0].dataIndex;
                return 'Total: ' + dataset[i].totalPerG.toFixed(1) + ' Yards/Spiel';
              }
            }
          }
        },
        scales: {
          x: { title: { display: true, text: 'Yards pro Spiel (Defense)' }, grid: { drawBorder: false } },
          y: { grid: { display: false }, offset: true }
        },
        animation: false
      }
    });
  }

  function sortDef(rows, mode) {
    const s = [...rows];
    if (mode === 'pass') s.sort((a,b) => b.passPerG - a.passPerG);
    else if (mode === 'rush') s.sort((a,b) => b.rushPerG - a.rushPerG);
    else s.sort((a,b) => b.totalPerG - a.totalPerG);
    return s;
  }

  /* -------------------- Einmaliger Init -------------------- */
  let offChart = null;
  let defChart = null;

  (async function init() {
    // OFFENSE
    const offRows = await loadOffense();
    if (offRows.length) {
      let offMode = 'ppg';
      let currentOff = [...offRows].sort((a,b) => b.ppg - a.ppg);
      const offCtx = document.getElementById('offPpgChart').getContext('2d');
      offChart = makeOffChart(offCtx, currentOff);

      const offCard = document.getElementById('offense-ppg');
      function setActiveOff(id) {
        offCard.querySelectorAll('.btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
      }
      function updateOff() {
        currentOff = (offMode === 'ppg')
          ? [...offRows].sort((a,b) => b.ppg - a.ppg)
          : [...offRows].sort((a,b) => a.team.localeCompare(b.team));
        offChart.data.labels = currentOff.map(d => d.team);
        offChart.data.datasets[0].data = currentOff.map(d => +d.ppg.toFixed(1));
        offChart.update();
      }
      document.getElementById('sortPPG').addEventListener('click', () => { offMode='ppg'; setActiveOff('sortPPG'); updateOff(); });
      document.getElementById('sortAlpha').addEventListener('click', () => { offMode='alpha'; setActiveOff('sortAlpha'); updateOff(); });
    } else {
      console.warn('Keine Offense-Daten gefunden.');
    }

    // DEFENSE
    const defRows = await loadDefense();
    if (defRows.length) {
      let defMode = 'total';
      let currentDef = sortDef(defRows, defMode);
      const defCtx = document.getElementById('defYdsChart').getContext('2d');
      defChart = makeDefChart(defCtx, currentDef);

      const defCard = document.getElementById('defense-yds');
      function setActiveDef(id) {
        defCard.querySelectorAll('.btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
      }
      function updateDef() {
        currentDef = sortDef(defRows, defMode);
        defChart.data.labels = currentDef.map(d => d.team);
        defChart.data.datasets[0].data = currentDef.map(d => +d.passPerG.toFixed(1));
        defChart.data.datasets[1].data = currentDef.map(d => +d.rushPerG.toFixed(1));
        defChart.update();
      }
      document.getElementById('sortTotal').addEventListener('click', () => { defMode='total'; setActiveDef('sortTotal'); updateDef(); });
      document.getElementById('sortPass').addEventListener('click', () => { defMode='pass'; setActiveDef('sortPass'); updateDef(); });
      document.getElementById('sortRush').addEventListener('click', () => { defMode='rush'; setActiveDef('sortRush'); updateDef(); });
    } else {
      console.warn('Keine Defense-Daten gefunden.');
    }
  })();
</script>


<script>
// Highlight current link
(function(){
  const current = location.pathname.split('/').pop() || 'index.html';
  document.querySelectorAll('a[href]').forEach(a=>{
    if(a.getAttribute('href')===current) a.classList.add('active');
  });
})();
// Mobile burger
(function(){
  const toggleBtn = document.querySelector('.nav-toggle');
  const panel = document.getElementById('navPanel');
  const overlay = document.getElementById('overlay');
  const draftToggle = document.getElementById('draftToggle');
  const mql = window.matchMedia('(max-width: 900px)');
  function openM(){ panel?.classList.add('open'); if(overlay) overlay.hidden=false; toggleBtn?.setAttribute('aria-expanded','true'); document.body.style.overflow='hidden'; }
  function closeM(){ panel?.classList.remove('open'); if(overlay) overlay.hidden=true; toggleBtn?.setAttribute('aria-expanded','false'); document.body.style.overflow=''; const dd=panel?.querySelector('.dropdown'); dd&&dd.classList.remove('open'); draftToggle?.setAttribute('aria-expanded','false'); }
  toggleBtn?.addEventListener('click',()=>{ panel?.classList.contains('open')?closeM():openM(); });
  overlay?.addEventListener('click', closeM);
  document.addEventListener('keydown', e=>{ if(e.key==='Escape') closeM(); });
  draftToggle?.addEventListener('click', ()=>{ const dd=draftToggle.closest('.dropdown'); const isOpen=dd.classList.toggle('open'); draftToggle.setAttribute('aria-expanded', String(isOpen)); });
  mql.addEventListener('change', e=>{ if(!e.matches) closeM(); });
})();
</script>

<!-- Unified Mobile Menu & Active Link (burger fix) -->
<script>
(function(){
  // Active link
  const current = location.pathname.split('/').pop() || 'index.html';
  document.querySelectorAll('a[href]').forEach(a=>{
    if(a.getAttribute('href') === current) a.classList.add('active');
  });

  const toggleBtn = document.querySelector('.nav-toggle');
  const panel     = document.getElementById('navPanel');
  const overlay   = document.getElementById('overlay');
  const draftBtn  = document.getElementById('draftToggle');
  const mql       = window.matchMedia('(max-width: 900px)');

  function openMenu(){
    panel && panel.classList.add('open');
    if (overlay) overlay.hidden = false;
    toggleBtn && toggleBtn.setAttribute('aria-expanded','true');
    document.body.style.overflow = 'hidden';
  }
  function closeMenu(){
    panel && panel.classList.remove('open');
    if (overlay) overlay.hidden = true;
    toggleBtn && toggleBtn.setAttribute('aria-expanded','false');
    document.body.style.overflow = '';
    const dd = panel ? panel.querySelector('.dropdown') : null;
    dd && dd.classList.remove('open');
    draftBtn && draftBtn.setAttribute('aria-expanded','false');
  }

  toggleBtn && toggleBtn.addEventListener('click', ()=>{
    panel && panel.classList.contains('open') ? closeMenu() : openMenu();
  });
  overlay && overlay.addEventListener('click', closeMenu);
  document.addEventListener('keydown', e=>{ if(e.key==='Escape') closeMenu(); });

  draftBtn && draftBtn.addEventListener('click', ()=>{
    const dd = draftBtn.closest('.dropdown');
    const isOpen = dd.classList.toggle('open');
    draftBtn.setAttribute('aria-expanded', String(isOpen));
  });

  panel && panel.querySelectorAll('a').forEach(a=>{
    a.addEventListener('click', ()=>{ if (mql.matches) closeMenu(); });
  });

  mql.addEventListener('change', e=>{ if (!e.matches) closeMenu(); });
})();
</script>
</body>
</html>
